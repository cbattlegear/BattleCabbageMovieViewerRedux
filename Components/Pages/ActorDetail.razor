@page "/actors/{ActorId:int}"
@using BattleCabbageMovieViewer.Models
@using BattleCabbageMovieViewer.Services
@inject IMovieApiService MovieApi
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>@(_actor?.Actor ?? "Actor") - Battle Cabbage</PageTitle>

<div class="max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8">
    <!-- Back Link -->
    <a href="/actors" class="inline-flex items-center gap-2 text-theme-secondary hover:text-gold transition-colors mb-6">
        <LucideIcon Name="arrow-left" Class="w-4 h-4" />
        Back to Actors
    </a>

    @if (_isLoading)
    {
        <div class="flex items-center justify-center py-20">
            <div class="flex flex-col items-center gap-4">
                <div class="spinner"></div>
                <p class="text-theme-secondary">Loading actor...</p>
            </div>
        </div>
    }
    else if (_actor is not null)
    {
        <!-- Actor Header -->
        <div class="flex items-center gap-5 mb-8">
            @if (!string.IsNullOrEmpty(_actor.FullImageUrl))
            {
                <img src="@_actor.FullImageUrl" alt="@_actor.Actor" class="w-24 h-24 rounded-full object-cover" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" />
                <div class="w-24 h-24 rounded-full bg-theme-tertiary items-center justify-center" style="display:none">
                    <LucideIcon Name="user" Class="w-12 h-12 text-theme-secondary" />
                </div>
            }
            else
            {
                <div class="w-24 h-24 rounded-full bg-theme-tertiary flex items-center justify-center">
                    <LucideIcon Name="user" Class="w-12 h-12 text-theme-secondary" />
                </div>
            }
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-theme-primary">@_actor.Actor</h1>
                <p class="text-theme-secondary mt-1">@_movies.Count movie@(_movies.Count != 1 ? "s" : "")</p>
            </div>
        </div>

        <!-- Movies -->
        @if (_movies.Any())
        {
            <h2 class="text-xl font-bold text-theme-primary flex items-center gap-2 mb-4">
                <LucideIcon Name="film" Class="w-5 h-5 text-gold" />
                Filmography
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                @foreach (var movie in _movies)
                {
                    <div class="card p-4 flex gap-4">
                        @if (movie.FullPosterUrl != null)
                        {
                            <img src="@movie.FullPosterUrl" alt="@movie.Title" class="w-16 h-24 rounded object-cover flex-shrink-0" />
                        }
                        <div class="min-w-0">
                            <p class="text-theme-primary font-medium line-clamp-2">@movie.Title</p>
                            @if (movie.ReleaseDate.HasValue)
                            {
                                <p class="text-theme-secondary text-sm mt-1">@movie.ReleaseDate.Value.Year</p>
                            }
                            @if (!string.IsNullOrEmpty(movie.Genre))
                            {
                                <p class="text-theme-secondary text-xs mt-1">@movie.Genre</p>
                            }
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="flex flex-col items-center justify-center py-20 text-theme-tertiary">
                <LucideIcon Name="film" Class="w-12 h-12 mb-4" />
                <p>No movies found for this actor.</p>
            </div>
        }
    }
</div>

@code {
    [Parameter]
    public int ActorId { get; set; }

    private ActorResponse? _actor;
    private List<MovieResponse> _movies = [];
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var actors = await MovieApi.GetActorsAsync(0, 1000);
            _actor = actors.FirstOrDefault(a => a.ActorId == ActorId);
            _movies = await MovieApi.GetActorMoviesAsync(ActorId);
        }
        finally
        {
            _isLoading = false;
        }
    }
}
