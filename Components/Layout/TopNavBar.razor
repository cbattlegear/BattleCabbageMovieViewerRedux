@inject IJSRuntime JSRuntime

<header class="fixed top-0 left-0 right-0 h-nav z-50 bg-theme-primary/80 border-b border-theme-primary" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);">
    <div class="max-w-7xl mx-auto px-4 md:px-6 lg:px-8 h-full flex items-center justify-between">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-2 text-theme-primary hover:text-gold transition-colors duration-200">
            <svg class="w-8 h-8 text-gold" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="M2 8h20"/><path d="M8 4v4"/><path d="M16 4v4"/><path d="M6 12h.01"/><path d="M10 12h.01"/><path d="M14 12h.01"/><path d="M18 12h.01"/><path d="M6 16h.01"/><path d="M10 16h.01"/><path d="M14 16h.01"/><path d="M18 16h.01"/></svg>
            <span class="font-bold text-lg hidden sm:inline">Battle Cabbage Movies</span>
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center gap-6">
            <NavLink href="" Match="NavLinkMatch.All" class="nav-link" ActiveClass="active">
                Home
            </NavLink>
            <NavLink href="movies" class="nav-link" ActiveClass="active">
                Movies
            </NavLink>
            <NavLink href="actors" class="nav-link" ActiveClass="active">
                Actors
            </NavLink>
            <NavLink href="directors" class="nav-link" ActiveClass="active">
                Directors
            </NavLink>
            <NavLink href="genres" class="nav-link" ActiveClass="active">
                Genres
            </NavLink>
        </nav>

        <!-- Right Section -->
        <div class="flex items-center gap-3">
            <!-- Theme Toggle -->
            <button class="btn-icon" @onclick="ToggleTheme" aria-label="Toggle theme">
                @if (_currentTheme == "dark")
                {
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                }
                else
                {
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                }
            </button>

            <!-- API Docs Link -->
            <a href="https://api.battlecabbage.com/docs" target="_blank"
               class="hidden lg:flex items-center gap-1 text-theme-secondary hover:text-gold text-sm transition-colors duration-200">
                API Docs
                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>
            </a>

            <!-- Mobile Menu Button -->
            <div class="md:hidden">
                <button class="btn-icon" @onclick="ToggleMobileMenu" aria-label="Menu">
                    @if (_mobileMenuOpen)
                    {
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    }
                    else
                    {
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                    }
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation Drawer -->
    @if (_mobileMenuOpen)
    {
        <div class="md:hidden absolute top-full left-0 right-0 bg-theme-secondary border-b border-theme-primary animate-fade-in">
            <nav class="flex flex-col p-4 gap-1">
                <NavLink href="" Match="NavLinkMatch.All" class="mobile-nav-link" ActiveClass="active" @onclick="CloseMobileMenu">
                    <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    Home
                </NavLink>
                <NavLink href="movies" class="mobile-nav-link" ActiveClass="active" @onclick="CloseMobileMenu">
                    <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18"/><path d="M3 7.5h4"/><path d="M3 12h18"/><path d="M3 16.5h4"/><path d="M17 3v18"/><path d="M17 7.5h4"/><path d="M17 16.5h4"/></svg>
                    Movies
                </NavLink>
                <NavLink href="actors" class="mobile-nav-link" ActiveClass="active" @onclick="CloseMobileMenu">
                    <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Actors
                </NavLink>
                <NavLink href="directors" class="mobile-nav-link" ActiveClass="active" @onclick="CloseMobileMenu">
                    <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"/><rect x="2" y="6" width="14" height="12" rx="2"/></svg>
                    Directors
                </NavLink>
                <NavLink href="genres" class="mobile-nav-link" ActiveClass="active" @onclick="CloseMobileMenu">
                    <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>
                    Genres
                </NavLink>
                <a href="https://api.battlecabbage.com/docs" target="_blank"
                   class="mobile-nav-link flex items-center" @onclick="CloseMobileMenu">
                    <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 7v14"/><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>
                    API Docs
                    <svg class="w-4 h-4 ml-auto" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>
                </a>
            </nav>
        </div>
    }
</header>

@code {
    [Parameter] public EventCallback<string> OnThemeChanged { get; set; }

    private bool _mobileMenuOpen = false;
    private string _currentTheme = "dark";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _currentTheme = await JSRuntime.InvokeAsync<string>("themeManager.getTheme");
            StateHasChanged();
        }
    }

    private async Task ToggleTheme()
    {
        _currentTheme = await JSRuntime.InvokeAsync<string>("themeManager.toggleTheme");
        await OnThemeChanged.InvokeAsync(_currentTheme);
    }

    private void ToggleMobileMenu()
    {
        _mobileMenuOpen = !_mobileMenuOpen;
    }

    private void CloseMobileMenu()
    {
        _mobileMenuOpen = false;
    }
}
